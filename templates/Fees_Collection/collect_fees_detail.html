{% extends 'base.html' %}


{% block body_block %}
{% load static %}

<div class="container-fluid">

  <div class="row">
    <div class="main-header">
      <h4>Student Fees</h4>
      <a href="{% url 'collect_fees' %}">
        <button type="button" class="btn btn-primary" style="float: right;">â‡¦ Back</button>
      </a>
    </div>
  </div>


  <div class="card" style="padding: 10px;">
    <div class="row">
      <div class="col-md-12">
        <div class="sfborder">
          <div class="col-md-3">
            <img class="round5"
              src="data:image/jpeg;base64,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"
              class="img-fluid">
            <!-- <img width="115" height="115" class="round5" src="https://www.school.infomainia.in/uploads/student_images/default_male.jpg" alt="No Image"> -->
          </div>

          <div class="col-md-9">
            <div class="row">
              <table class="table">
                <tbody>
                  <tr>
                    <th class="bozero">Name</th>
                    <td class="bozero">{{records.first_name}} {{records.last_name}}</td>

                    <th class="bozero">Class Section</th>
                    <td class="bozero">{{records.Class}} ({{records.section}}) </td>
                  </tr>
                  <!-- <tr>
                    <th>Father Name</th>
                    <td>{{records.Father_name}}</td>
                    <th>Admission No</th>
                    <td>{{records.admission_no}}</td>
                  </tr> -->
                  <tr>
                    <th>Mobile Number</th>
                    <td>{{records.mobile_number}}</td>
                    <th>Roll Number</th>
                    <td> {{records.roll_number}} </td>
                  </tr>
                  <tr>
                    <th>Category</th>
                    <td>
                      {{records.category}} </td>
                    <th>RTE</th>
                    <td><b class=""> {{records.rte}} </b>
                    </td>
                  </tr>

                </tbody>
              </table>
            </div>
          </div>


        </div>
      </div>


    </div>
  </div>


  <div class="card" style="padding: 10px; font-size:13px;">
    <div class="card-body">

      <br>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead style="background-color: rgb(106, 123, 160); color:white;">
            <tr>
              <th> </th>
              <th>Fees Group</th>
              <th>Fees Code</th>
              <th>Due Date</th>
              <th>Status</th>
              <th>Amount</th>
              <th>Payment Id</th>
              <th>Mode</th>
              <th>Date</th>
              <th>Discount</th>
              <th>Fine</th>
              <th>Paid</th>
              <th>Balance</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for data in fees_records %}
            <tr>
              <td></td>
              <td><input type="hidden" value="{{data.id}}" id="table_fees_id">{{data.fees.fees_group}}</td>
              <td>{{data.fees.fees_type.Fees_code}}</td>
              <td>{{data.fees.due_date|date:"d/m/Y"}}</td>
              <td> {% if data.status == 'fully paid' %}<label class="label label-success">{{data.status}}{% else %}<label class="label label-warning">{{data.status}}{% endif %} </label></td>
              <td> <input type="hidden" value="{{data.balance_amount}}" id="table_amount">{{data.fees.amount}}</td>
              <td></td>
              <td></td>
              <td></td>
              <td><input type="hidden" value="{{data.fees.percentage}}" id="table_percentage">{{data.Dicount_amount}}
              </td>
              <td><input type="hidden" value="{% if data.fees.fine_amount %}{{data.fees.fine_amount}}{% else %}0{% endif %}" id="table_fine_amount">{{data.fine_amount}}
              </td>
              <td>{{data.paid_amount}}</td>
              <td>{{data.balance_amount}}</td>
              <td>{% if data.status != 'fully paid' %} <a data-toggle="modal" data-target=".edit" style="color: black;"
                  id="dropdownMenuButton"><i class='fa fa-plus'></i></a>
                {% endif %}
                <a href="{% url 'print_master_fees' data.id  %}"><i class="fa fa-print"></i></a>
              </td>
              

            </tr>
            {% for paid in paid_record %}
            {% if paid.fess_id == data.id %}
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td><img src="https://www.school.infomainia.in/backend/images/table-arrow.png" alt=""></td>
                    <td><input type="hidden" value="{{data.fees.amount}}">{{paid.id}}</td>
                    <td>{{paid.payment_mode_fee}}</td>
                    <td>{{paid.created_at|date:"d/m/Y"}}</td>
                    <td>{{paid.amount_discount}}</td>
                    <td>{{paid.amount_fine}}</td>
                    <td>{{paid.paid_amount}}</td>
                    <td></td>
                    <td>
                        <!-- <a href="#" class="bozero edit-btn" 
                          data-payment-mode="{{paid.payment_mode_fee}}" 
                          data-discount="{{paid.amount_discount}}" 
                          data-fine="{{paid.amount_fine}}" 
                          data-uniqueid="{{paid.id}}"
                          data-fess_ids="{{paid.fess_id}}"
                          data-paid="{{paid.paid_amount}}" 
                          data-date="{{paid.created_at|date:"d/m/Y"}}"
                          data-toggle="tooltip" title="Edit" style="color: black;">
                            <i class="fa fa-edit"></i>
                        </a> -->
                        <p>
                            <a href="{% url 'print_fees' paid.id %}"><i class="fa fa-print"></i></a>
                        </p>
                        <!-- <p><i class="fa fa-undo"></i></p> -->
                    </td>
                </tr>
            {% endif %}
        {% endfor %}
   
            {% endfor %}

            {% for data in fees_discount %}
            <tr style="background-color: whitesmoke;">
              <td></td>
              <td>Discount</td>
              <td> {{data.discount.name}}</td>
              <td></td>
              <td>
                {% if data.status == 'applied' or data.status == 'appalied' %}
                <p style="color:red;">Discount of ${{data.discount.amount}} applied</p>
                {% elif data.status == 'pending' %}
                Discount of ${{data.discount.amount}} Assigned
                {% endif %}
              </td>
              <td colspan="9"> </td>

            </tr>
            {% endfor %}
          </tbody>

        </table>
      </div>
    </div>
  </div>
</div>
<br><br><br>

<!-- <---start model ---->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Edit Payment Details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="reloadPage()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form method="post" id="feesForm">
          {% csrf_token %}
          <input type="hidden" id="dataIdField" name="data_id">
          <input type="hidden" value="{{ pk }}" id="pkValue">
          <input name="fees_idd" id="fess_ids"  type="hidden" />
          <!-- Display data fields here -->

          <div class="form-group">
            <label for="paymentMode">Payment Mode</label>
            <div id="paymentModeOptions">
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="Cash" > Cash
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="Cheque"> Cheque
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="DD"> DD
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="bank_transfer"> Bank Transfer
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="m-pesa"> M-Pesa
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="card"> Card
              </label>

           
              <span class="text-danger" id="payment_mode_error"></span>
            </div>
          </div>
          <div class="form-group">
            <label for="discountAmount">Discount Amount</label>
            <input type="text" class="form-control" name="amount_discount" id="discountAmount" readonly>
          </div>
          <div class="form-group">
            <label for="fineAmount">Fine Amount</label>
            <input type="text" class="form-control" id="fineAmount" name="amount_fine" readonly>
          </div>
          <div class="form-group">
            <label for="paidAmount">Paid Amount</label>
            <input type="text" class="form-control" id="paidAmount" name="amount">
          </div>
          <div class="form-group">
            <label for="paymentDate">Payment Date</label>
            <input type="date" class="form-control" id="paymentDate" name="payment_date">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal"onclick="reloadPage()">Close</button>
        <button type="submit" class="btn btn-primary" form="feesForm">Submit</button>
      </div>
    </div>
  </div>
</div>
 <!-- --- end model---- -->
<!-- modal Start -->

<div class="modal fade edit" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Admission Enquiry</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form method="post"><br>
          {% csrf_token %}
          
          <div class="form-group">
            <label for="paymentMode">Payment Mode</label>
            <div id="paymentModeOptions">
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="Cash" checked> Cash
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="Cheque"> Cheque
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="DD"> DD
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="bank_transfer"> Bank Transfer
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="m-pesa"> M-Pesa
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="card"> Card
              </label>
              <label class="radio-inline">
                <input type="radio" name="payment_mode_fee" value="vault" id="vault-radio"> Vault
              </label>
              <span id="vault-amount" style="display: none; font-weight: bold;"> Amount : {{ student_vault }}</span>
              <span class="text-danger" id="total_amount_error"></span>
            </div>
          </div>
          <div class="form-group">
            <label for="inputEmail3" class="col-sm-3 control-label">Date</label>
            <div class="col-sm-9">
              <input id="date" name="admission_date" placeholder="" type="text" class="form-control date_fee"
                value="{{toady_date}}" readonly="readonly" />
              <input name="fees_id" id="fess_idd" placeholder="" type="Hidden" />
            </div>
          </div><br>
          <div class="form-group">
            <label for="total_amount" class="col-sm-3 control-label">Total Amount<small class="req" > *</small></label>
            <div class="col-sm-9">
              <input type="number" class="form-control modal_amount" id="total_amount" name="total_amount" onkeyup="update_balance()" required> 
              <span class="text-danger" id="total_amount_error"></span>
            </div>
          </div>
          <br>
          <div class="form-group">
            <label for="amount" class="col-sm-3 control-label">Amount<small class="req"> *</small></label>
            <div class="col-sm-9">
              <input type="text" class="form-control modal_amount" id="amount" name="amount" onkeyup="update_balance()" readonly>
              <span class="text-danger" id="amount_error"></span>
            </div>
          </div>
          <br>
          <div class="form-group">
            <label for="balance_amount" class="col-sm-3 control-label">Vault Amount<small class="req"> *</small></label>
            <div class="col-sm-9">
              <input type="text" class="form-control modal_amount" id="balance_amount" name="balance_amount" readonly>
            </div>
          </div>
          
     
          <br>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-3 control-label"> Discount Group</label>
            <div class="col-sm-9">
              <select class="form-control modal_discount_group" id="discount_group" name="discount_group">
                <option value="">Select</option>
                {% for data in fees_discount %}
                {% if data.status == 'pending' %}
                <option value="{{data.id}}">{{data.discount.name}}</option>
                {% endif %}
                {% endfor %}
              </select>

              <span class="text-danger" id="amount_error"></span>
            </div>
          </div>

          <br>
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-3 control-label">Discount<small class="req"> *</small></label>
            <div class="col-sm-9">
              <div class="row">

                <div class="col-md-5 col-sm-5">
                  <div class="">
                    <input type="text" class="form-control" id="amount_discount" value="0" name="amount_discount">

                    <span class="text-danger" id="amount_error"></span>
                  </div>
                </div>
                <div class="col-md-2 col-sm-2 ltextright">

                  <label for="inputPassword3" class="control-label">Finedd<small class="req">*</small></label>
                </div>
                <div class="col-md-5 col-sm-5">
                  <div class="">
                    <input type="number" class="form-control" id="amount_fine" value="0" name="amount_fine" >

                    <span class="text-danger" id="amount_fine_error"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br>
          <div class="container">
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label for="paid_by">Paid By</label>
                  <input type="text" class="form-control" name="paid_by" placeholder="Enter name of payer">
                </div>
              </div>
          
              <div class="col-md-4">
                <div class="form-group">
                  <label for="ref_number">Reference Number</label>
                  
                  <input type="number" class="form-control" name="ref_number" placeholder="Enter reference number">
                </div>
              </div>
          
              <div class="col-md-4">
                <div class="form-group">
                  <label for="card_holder_name">Card Holder Name</label>
                  <input type="text" class="form-control" name="card_holder_name" placeholder="Enter card holder name">
                </div>
              </div>
            </div>
          
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label for="mobile_number">Mobile Number</label>
                  <input type="number" class="form-control" name="mobile_number" placeholder="Enter mobile number">
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="form-group">
                  <label for="amount">Amount</label>
                  <input type="number" class="form-control" name="user_amount" placeholder="Enter amount">
                </div>
              </div>
            </div>
          </div>
        
          <div class="form-group">
            <label for="inputPassword3" class="col-sm-3 control-label">Note</label>
            <div class="col-sm-9">
              <textarea class="form-control" rows="3" id="description" placeholder="" name="description"></textarea>
            </div>
          </div>
          <br>
          <center>
            <button type="sumbit" class="btn btn-primary">Submit</button>
          </center>
        </form>

      </div>
    </div>
  </div>
</div>

<!-- modal End -->
{% endblock %}
{% block script_block %}



<script>
  $(document).ready(function () {

    $(document).on('click', '#dropdownMenuButton', function () {
      var dumy = this;
      var amount = $(dumy).closest('tr').find('#table_amount').val();
      var percentage = $(dumy).closest('tr').find('#table_percentage').val();
      var fine = $(dumy).closest('tr').find('#table_fine_amount').val();
      var id = $(dumy).closest('tr').find('#table_fees_id').val();
      $('#amount').val(amount);
      $('#ref_amount').val(amount);
      <!-- $('#amount_discount').val(percentage); -->
      $('#amount_fine').val(fine);
      $('#fess_idd').val(id);
    });
    $(document).on('change', '#discount_group', function () {
      var disc = this.value;
      var url = "{% url 'discount_js' %}";
      $.ajax({
        url: url,
        data: {
          'disc': disc
        },
        success: function (data) {
          $('#amount_discount').val(data);
        },
        error: function (data) {
          console.log(data);
        }
      });
    });
  });

</script>

<!--  amount validation inside model -->


<script>
  $(document).ready(function() {
    // Open modal and populate with data when edit button is clicked
    $('.edit-btn').on('click', function(event) {
      event.preventDefault();
  
      // Get data attributes from the clicked button
      let paymentMode = $(this).data('payment-mode');
      let discount = $(this).data('discount');
      let fine = $(this).data('fine');
      let paid = $(this).data('paid');
      let uniqueid = $(this).data('uniqueid');
      let paymentDate = $(this).data('date');
      let dataId = $(this).data('id'); 
      let fessId = $(this).data('fess_ids');
      console.log("fess_ids:", fessId);
  
      // Format the date if necessary
      if (paymentDate.includes('/')) {
        let parts = paymentDate.split('/');
        paymentDate = `${parts[2]}-${parts[1]}-${parts[0]}`;
      } else if (paymentDate.includes('-')) {
        let parts = paymentDate.split('-');
        if (parts[2].length === 4) {
          paymentDate = `${parts[2]}-${parts[0]}-${parts[1]}`;
        }
      }
  
      // Set data in modal fields
      $('input[name="payment_mode_fee"][value="' + paymentMode + '"]').prop('checked', true);
      $('#discountAmount').val(discount);
      $('#fineAmount').val(fine);
      $('#paidAmount').val(paid);
      $('#paymentDate').val(paymentDate);
      $('#fess_ids').val(fessId);
  
      // Set the form action and hidden input
      setFormAction(uniqueid);
  
      // Show the modal
      $('#editModal').modal('show');
    });
  });
  
  function setFormAction(uniqueid) {
    const form = document.getElementById('feesForm');
    const dataIdField = document.getElementById('dataIdField');
    const pkField = document.getElementById('pkValue').value; // Get pk value
  
    // Check if dataIdField is already populated
    if (dataIdField.value) {
      
    } else {
      // Set the form action to include both uniqueid and pk in the URL
      form.action = `/collect_fees_edit/${uniqueid}/${pkField}`;  // Use uniqueid instead of dataId
      dataIdField.value = uniqueid;  // Set the data_id field to uniqueid
  
      // Show a confirmation alert when the action is set
      
    }
  }
</script>

<script>
  // Refresh the page when the modal is hidden (when the user clicks outside or closes the modal)
  $('#editModal').on('hidden.bs.modal', function () {
    location.reload();  // Reload the page when the modal is closed
  });
</script>

<script>
  function reloadPage() {
    location.reload();  // Reload the page
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      const paymentModeOptions = document.querySelectorAll('input[name="payment_mode_fee"]');
      const vaultAmount = document.getElementById("vault-amount");

      paymentModeOptions.forEach(option => {
          option.addEventListener("change", function () {
              if (this.value === "vault") {
                  vaultAmount.style.display = "inline"; // Show the vault amount
              } else {
                  vaultAmount.style.display = "none"; // Hide the vault amount
              }
          });
      });
  });
</script>


<script>
  function update_balance() {
    // Get the input values
    const totalAmount = parseFloat(document.getElementById('total_amount').value) || 0;
    const studentVault = parseFloat("{{ student_vault }}") || 0; // Replace with the actual student vault value
    const receivedAmount = parseFloat(document.getElementById('amount').value) || 0;
  
    // Validate the input amounts
    const amountError = document.getElementById('amount_error');
    const balanceAmountField = document.getElementById('balance_amount');
    const totalAmountError = document.getElementById('total_amount_error');
    
    // Get the selected payment mode
    const paymentMode = document.querySelector('input[name="payment_mode_fee"]:checked')?.value;
  
    if (paymentMode === "vault") {
      // Ensure total amount is not greater than the student vault value
      if (totalAmount > studentVault) {
        totalAmountError.textContent = 'Total amount cannot exceed the student vault value.';
        balanceAmountField.value = ''; // Clear the balance if invalid
        alert('Total amount exceeds the vault amount!'); // Show the alert message
        document.getElementById('total_amount').value = studentVault; // Set total amount to the vault amount
      } else {
        totalAmountError.textContent = '';
  
        // Check if received amount is valid
        if (receivedAmount > totalAmount) {
          amountError.textContent = 'Enter an amount less than or equal to the total amount';
          balanceAmountField.value = ''; // Clear the balance if invalid
        } else {
          amountError.textContent = '';
          // Calculate the balance amount
          let balanceAmount = totalAmount - receivedAmount;
          
          // If the balance amount is negative, set it to 0.00
          if (balanceAmount < 0) {
            balanceAmount = 0;
          }
  
          // Update the balance amount field
          balanceAmountField.value = balanceAmount.toFixed(2); // Display with 2 decimal places
        }
      }
    } else {
      // If the payment mode is not vault, remove the restriction and allow any value
      totalAmountError.textContent = ''; // Clear any error message
      let balanceAmount = totalAmount - receivedAmount;
  
      // If the balance amount is negative, set it to 0.00
      if (balanceAmount < 0) {
        balanceAmount = 0;
      }
  
      // Update the balance amount field
      balanceAmountField.value = balanceAmount.toFixed(2); // Recalculate and update the balance
    }
  }
  
  document.addEventListener('DOMContentLoaded', function () {
    const paymentModeRadios = document.querySelectorAll('input[name="payment_mode_fee"]');
    const totalAmountField = document.getElementById("total_amount");
    const vaultAmountLabel = document.getElementById("vault-amount");
    const totalAmountError = document.getElementById("total_amount_error");
  
    // Add event listeners to each radio button
    paymentModeRadios.forEach(function(radio) {
      radio.addEventListener("change", function() {
        if (this.value === "vault") {
          // When Vault is selected, show the vault amount and populate the total amount
          const vaultAmount = "{{ student_vault }}"; // Replace with your backend dynamic value
          totalAmountField.value = vaultAmount;
          vaultAmountLabel.style.display = "inline-block"; // Show vault amount
          update_balance(); // Recalculate the balance if needed
  
          // Check if the total amount is empty when Vault is selected
          validateVaultAmount();
        } else {
          // Clear total amount and hide vault amount if other payment mode is selected
          totalAmountField.value = "";
          vaultAmountLabel.style.display = "none"; // Hide vault amount
          totalAmountError.textContent = ""; // Clear any existing error message
          update_balance(); // Recalculate the balance with the cleared amount
        }
      });
    });
  
    // Validate the total amount if Vault is selected
    function validateVaultAmount() {
      if (totalAmountField.value === "") {
        totalAmountError.textContent = "Please specify an amount for the Vault payment mode.";
      } else {
        totalAmountError.textContent = ""; // Clear error message if amount is entered
      }
    }
  
    // Optional: Trigger validation if user tries to submit the form
    const form = document.querySelector('form'); // Assume your form has a <form> tag
    form.addEventListener('submit', function(event) {
      if (document.getElementById("vault-radio").checked) {
        validateVaultAmount();
        if (totalAmountField.value === "") {
          event.preventDefault(); // Prevent form submission if validation fails
        }
      }
    });
  });
  
</script>
{% endblock %}