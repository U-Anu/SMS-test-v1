{% extends 'base.html' %}
{% load static %}

{% block body_block %}

<div class="row">
    <div class="main-header">
        <h4>Online Classes</h4>
    </div>
</div>

<!-- ADD BUTTON -->
<div class="col" style="padding: 30px;">
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg" style="float:right;">
        Add
    </button>
</div>

<!-- ================= MODAL START ================= -->
<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Online Classes</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <!-- IMPORTANT: enctype added -->
                <form id="online_class_form" method="post" enctype="multipart/form-data">
                    {% csrf_token %}

                    <div class="row">

                        <div class="col-md-4 mb-3">
                            <label>Class Title</label>
                            {{ form.class_title }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Class Date Time</label>
                            {{ form.class_date_time }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Start Time</label>
                            {{ form.start_time }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>End Time</label>
                            {{ form.end_time }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Role</label>
                            {{ form.role }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Staff</label>
                            {{ form.staff }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Class</label>
                            {{ form.Class }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Section</label>
                            {{ form.section }}
                        </div>

                        <!-- MEETING LINK -->
                        <div class="col-md-4 mb-3">
                            <label>Meeting Link</label>
                            <select id="meeting_link" name="meeting_link" class="form-control">
                                <option value="" selected disabled>-- Select Link --</option>
                                <option value="new">Add New Link</option>
                                {% for link in meeting_links %}
                                    <option value="{{ link.id }}" data-url="{{ link.link }}">
                                        {{ link.link_for }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Meeting URL</label>
                            <input type="text" id="meeting_url" name="meeting_url" class="form-control" readonly>
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Description</label>
                            {{ form.description }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Status</label>
                            {{ form.status }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Meeting Document</label>
                            {{ form.meeting_document }}
                        </div>

                        <div class="col-md-4 mb-3">
                            <label>Meeting Notes</label>
                            {{ form.meeting_notes }}
                        </div>

                    </div>

                    <div class="text-right">
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>

                </form>
            </div>

        </div>
    </div>
</div>
<!-- ================= MODAL END ================= -->

<!-- ================= TABLE ================= -->
<div class="col-md-12">
    <div class="card" style="padding:10px;">
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Date Time</th>
                        <th>Start</th>
                        <th>End</th>
                        <th>Created By</th>
                        <th>Staff</th>
                        <th>Class</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody>
                {% for data in records %}
                    <tr>
                        <td>{{ data.class_title }}</td>
                        <td>{{ data.description }}</td>
                        <td>{{ data.class_date_time }}</td>
                        <td>{{ data.start_time }}</td>
                        <td>{{ data.end_time }}</td>
                        <td>{{ data.created_by }}</td>
                        <td>{{ data.staff }}</td>

                        <td>
                            Class {{ data.Class }}
                            (
                            {% for sec in data.section.all %}
                                {{ sec.section_name }}{% if not forloop.last %}, {% endif %}
                            {% endfor %}
                            )
                        </td>

                        <td>
                            <span class="badge
                                {% if data.status == 'Finished' %}badge-success
                                {% elif data.status == 'Awaited' %}badge-warning
                                {% else %}badge-danger{% endif %}">
                                {{ data.status }}
                            </span>
                        </td>

                        <td>
                            <a href="{{ data.meeting_url }}" target="_blank" class="btn btn-success btn-sm">
                                <i class="fa fa-video"></i> Start
                            </a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>

            </table>
        </div>
    </div>
</div>

{% endblock %}

{% block script_block %}

<!-- TOOLTIP -->
<script>
$(function () {
    $('[data-toggle="tooltip"]').tooltip();
});
</script>

<!-- MEETING LINK SCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const meetingLink = document.getElementById("meeting_link");
    const meetingUrl = document.getElementById("meeting_url");

    meetingLink.addEventListener("change", function () {
        const option = meetingLink.options[meetingLink.selectedIndex];

        if (option.value === "new") {
            meetingUrl.readOnly = false;
            meetingUrl.value = "";
        } else {
            meetingUrl.readOnly = true;
            meetingUrl.value = option.getAttribute("data-url");
        }
    });

});
</script>

{% endblock %}
